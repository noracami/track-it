{% extends "base.html" %}
{% block hey %}
    <div class="row">
        <div class="col-md-10">
            <h2>{{ issue_get.title }} <span style="color:#aaa">#{{ issue_get.id }}</span></h2>
        </div>
    </div>
    {% if issue_get.status %}
    {# is close? #}
    {# yes #}
    <div style="float: left;">
        <h4><span class="label label-danger"><span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span> Closed</span></h4>
    </div>
    {% else %}
    {# no #}
    <div style="float: left;">
        <h4><span class="label label-success"><span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span> Open</span></h4>
    </div>
    {% endif %}
    <div><h4></h4>&nbsp;&nbsp;<a href="/users/{{ opened_user.id }}">{{ opened_user.account }}</a> opened this issue on {{ issue_get.time|date:"Y/m/d H:i:s" }} · {{ issue_get.howmanycomments }} comments</div>
    <div class="row"></div>
    <hr>
    <div style="position: relative;">
        {# #}
        <div class="comment-wraper">
            {% for c in issue_get.comment %}
            <div class="row-message">
                <div class="media">
                    <div class="media-left media-top">
                        <a href="/users/{{ c.user.id }}">
                            <img class="media-object" src="{{ c.user.photo_path }}" width="60" height="60" alt="">
                        </a>
                    </div>
                    <div class="media-body">
                        <div class="panel panel-default">
                            <div class="panel-heading container-fluid">
                                <h3 class="panel-title" style="float: left;"><a href="/users/{{ c.user.id }}">{{ c.user.name }} (@{{ c.user.account }})</a> commented on {{ c.time|date:"Y/m/d H:i:s" }}</h3>
                                <span class="pull-right badge">{{ c.user.member }}</span>
                            </div>
                            <div class="panel-body">
                                {% if c.content %}
                                {{c.content|linebreaks}}
                                {% else %}
                                <i>No description provided.</i>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        <div class="status-wraper">
            <div class="row">
                <div class="col-xs-12">
                    <div class="panel panel-default">
                        <div id="changeLabels" class="panel-heading container-fluid">
                            <label class="panel-title"><span class="glyphicon glyphicon-tags" aria-hidden="true"></span> 標籤</label>
                        </div>
                        <div id="mybody" class="panel-body">
                            {% for label in issue_get.label %}
                            <div class="list-group" style="box-shadow: none;">
                                <a href="/?label={{label.id}}" class="list-group-item" style="padding: 0; background-color: inherit; border: 0;">
                                    <span style="border-radius: 5px; font-weight: bold; padding: 3px; background-color: #{{label.color}}; color: #{{label.fontcolor}};">{{ label }}</span>
                                </a>
                            </div>
                            {% empty %}
                            <i style="color: #999;">None yet.</i>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-xs-12">
                    <div class="panel panel-default">
                        <div id="changeLabels" class="panel-heading container-fluid">
                            <label class="panel-title"><span class="glyphicon glyphicon-cog" aria-hidden="true"></span> 設定標籤</label>
                        </div>
                        <div id="mybody" class="panel-body">
                            {% if request.session.login %}
                            <form name="form_editlabel" action="{% url 'change_status' %}" method="POST">
                                {% csrf_token %}
                                <input type="hidden" name="todo" value="editlabel">
                                <input type="hidden" name="issue_id" value="{{ issue_get.id }}">
                                {% for label in label_list %}
                                <div class="list-group" style="box-shadow: none;">
                                    <input {% if label.ischecked %}checked{% endif %} type="checkbox" name="checkbox" id="checkbox{{ label.label.id }}" value="{{ label.label.id }}">
                                    <label for="checkbox{{ label.label.id }}"><span style="border-radius: 5px; font-weight: bold; padding: 3px; background-color: #{{label.label.color}}; color: #{{label.label.fontcolor}};">{{ label.label }}</span></label>
                                </div>
                                {% endfor %}
                                <button id="submit02" type="submit" class="btn btn-success btn-sm pull-right">
                                    <span class="glyphicon glyphicon-saved" aria-hidden="true"></span> 送出
                                </button>
                            </form>
                            {% else %}
                            <a href="/loginhere" type="button" class="btn btn-info navbar-btn">登入</a>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {# #}
        <div class="row"></div>
        <hr>
        <div class="comment-wraper">
            <div class="row-message">
                <div class="media">
                    <div class="media-left media-top">
                        <img class="media-object" src="{{ photo_path }}" width="60" height="60" alt="">
                    </div>
                    <div class="media-body">
                        <div class="panel-default panel">
                            {% if request.session.login %}
                            <form name="form_newcomment" action="{% url 'add' %}" method="POST">
                                {% csrf_token %}
                                <input type="hidden" name="todo" value="newcomment">
                                <input type="hidden" name="issue_id" value="{{ issue_get.id }}">
                                <div class="panel-body">
                                    <div class="form-group">
                                        <textarea class="form-control form-required" placeholder="Leave a comment" name="comment" id="comment01" style="resize:none" cols="30" rows="6"></textarea>
                                    </div>
                                    <button id="submit01" type="submit" class="btn btn-success pull-right disabled">
                                        <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span> 送出
                                    </button>
                                </div>
                            </form>
                            {% else %}
                            <form name="form_newcomment" action="{% url 'add' %}" method="POST">
                                {% csrf_token %}
                                <input type="hidden" name="todo" value="newcomment">
                                <input type="hidden" name="guest" value="True">
                                <input type="hidden" name="issue_id" value="{{ issue_get.id }}">
                                <div class="panel-body">
                                    <div class="form-group">
                                        <textarea class="form-control form-required" placeholder="Leave a comment" name="comment" id="comment01" style="resize:none" cols="30" rows="6"></textarea>
                                    </div>
                                    <div class="form-inline form-group">
                                        <label for="guestname01">如何稱呼 </label>
                                        <input class="form-control form-required" placeholder="name" name="guestname" id="guestname01" type="text">
                                        <button id="submit01" type="submit" class="btn btn-success pull-right disabled">
                                            <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span> 訪客留言
                                        </button>
                                    </div>
                                </div>
                            </form>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
{% block customjs %}
<script>
    $(".form-required").on("change", function(){
        /* Do something... */
        var isValid = true;
        $('.form-required').each(function(){
            if ($(this).val() === '')
                isValid = false;
        });
        if (isValid)
            $("#submit01").removeClass("disabled");
        else
            $("#submit01").addClass("disabled");
    });
</script>
<script>
    /*
    $("#changeLabels").toggle(function() {
        //if($("#mybody").)
        alert( "First handler for .toggle() called." );
    });
*/
</script>
{% endblock %}